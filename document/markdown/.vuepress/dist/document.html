<!DOCTYPE html>
<html lang="简体中文">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>shadow-tracker（中文） | shadow-tracker 文档</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="一款轻量级的前端无感知监控插件">
    
    <link rel="preload" href="/shadow-tracker/assets/css/0.styles.eb7694a3.css" as="style"><link rel="preload" href="/shadow-tracker/assets/js/app.0379027f.js" as="script"><link rel="preload" href="/shadow-tracker/assets/js/2.05e023a7.js" as="script"><link rel="preload" href="/shadow-tracker/assets/js/8.03e55139.js" as="script"><link rel="prefetch" href="/shadow-tracker/assets/js/10.fe52c43f.js"><link rel="prefetch" href="/shadow-tracker/assets/js/3.994cdbe6.js"><link rel="prefetch" href="/shadow-tracker/assets/js/4.b33c0ee4.js"><link rel="prefetch" href="/shadow-tracker/assets/js/5.7f7ed661.js"><link rel="prefetch" href="/shadow-tracker/assets/js/6.93271839.js"><link rel="prefetch" href="/shadow-tracker/assets/js/7.26e52e8f.js"><link rel="prefetch" href="/shadow-tracker/assets/js/9.8350e143.js">
    <link rel="stylesheet" href="/shadow-tracker/assets/css/0.styles.eb7694a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/shadow-tracker/" class="home-link router-link-active"><!----> <span class="site-name">shadow-tracker 文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/shadowings-zy/shadow-tracker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shadow-tracker/document.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/shadow-tracker/en/document.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/shadowings-zy/shadow-tracker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shadow-tracker/document.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/shadow-tracker/en/document.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>shadow-tracker（中文）</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/shadow-tracker/document.html#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/shadow-tracker/document.html#使用方法" class="sidebar-link">使用方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#通过-npm-引入" class="sidebar-link">通过 npm 引入</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#通过-script-标签引入" class="sidebar-link">通过&lt;script&gt;标签引入</a></li></ul></li><li><a href="/shadow-tracker/document.html#api-说明" class="sidebar-link">API 说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#init-options" class="sidebar-link">init(options)</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#getdeviceinfo" class="sidebar-link">getDeviceInfo()</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#getperformanceinfo" class="sidebar-link">getPerformanceInfo()</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#getloglist" class="sidebar-link">getLogList()</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#gettimetravelcode" class="sidebar-link">getTimeTravelCode()</a></li></ul></li><li><a href="/shadow-tracker/document.html#配置项说明" class="sidebar-link">配置项说明</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/shadow-tracker/document.html#loglist-说明及自定义-log" class="sidebar-link">logList 说明及自定义 Log</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#log-对象说明" class="sidebar-link">Log 对象说明</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#event-log-对象说明" class="sidebar-link">Event Log 对象说明</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#error-log-对象说明" class="sidebar-link">Error Log 对象说明</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#xmlhttprequest-log-对象说明" class="sidebar-link">XMLHttPRequest Log 对象说明</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#device-log-对象说明" class="sidebar-link">Device Log 对象说明</a></li><li class="sidebar-sub-header"><a href="/shadow-tracker/document.html#performance-log-对象说明" class="sidebar-link">Performance Log 对象说明</a></li></ul></li><li><a href="/shadow-tracker/document.html#时间旅行功能" class="sidebar-link">时间旅行功能</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="shadow-tracker-中文"><a href="#shadow-tracker-中文" class="header-anchor">#</a> shadow-tracker（中文）</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>shadow-tracker 是一款轻量级的前端无感知监控插件，它提供的功能有：</p> <table><thead><tr><th>序号</th> <th>功能</th> <th>对应日志类型</th></tr></thead> <tbody><tr><td>1</td> <td>收集用户与网页交互时的点击、键盘输入事件</td> <td>事件日志（Event Log）</td></tr> <tr><td>2</td> <td>收集所有 JS 的错误信息</td> <td>错误日志（Error Log）</td></tr> <tr><td>3</td> <td>收集所有 XMLHTTPRequest 网络请求信息</td> <td>请求日志（XMLHttpRequest Log）</td></tr> <tr><td>4</td> <td>收集页面加载的性能数据信息</td> <td>性能日志（Performance Log）</td></tr> <tr><td>5</td> <td>收集用户的设备信息</td> <td>设备日志（Device Log）</td></tr> <tr><td>6</td> <td>提供时间旅行功能，可根据用户的操作生成 NightWatch e2e 测试代码，复现用户的每一步操作</td> <td>无</td></tr> <tr><td>7</td> <td>支持对日志的自定义拓展</td> <td>无</td></tr></tbody></table> <p>备注：“页面的性能数据信息”日志功能支持 IE9 及以上浏览器，其他日志功能均支持 IE7 及以上浏览器。</p> <h2 id="使用方法"><a href="#使用方法" class="header-anchor">#</a> 使用方法</h2> <h3 id="通过-npm-引入"><a href="#通过-npm-引入" class="header-anchor">#</a> 通过 npm 引入</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> shadow-tracker
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 使用import引入tracker即可访问tracker的API</span>
<span class="token comment">// 这里只呈现了“初始化tracker”以及“获取日志信息”的代码，其他API使用请参照第三部分“API说明”</span>

<span class="token keyword">import</span> tracker <span class="token keyword">from</span> <span class="token string">'shadow-tracker'</span>

tracker<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 初始化tracker</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tracker<span class="token punctuation">.</span><span class="token function">getLogList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 获取日志信息</span>
</code></pre></div><h3 id="通过-script-标签引入"><a href="#通过-script-标签引入" class="header-anchor">#</a> 通过<code>&lt;script&gt;</code>标签引入</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.shadowingszy.top/ShadowTracker/script/shadow-tracker-script.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 引入之后tracker对象就会挂到window对象下，使用window.tracker即可访问tracker的API</span>
  <span class="token comment">// 这里只呈现了“初始化tracker”以及“获取日志信息”的代码，其他API使用请参照第三部分“API说明”</span>

  window<span class="token punctuation">.</span>tracker<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 初始化tracker</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>tracker<span class="token punctuation">.</span><span class="token function">getLogList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 获取日志信息</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注：由于服务器资源有限，建议先从<code>&quot;http://www.shadowingszy.top/ShadowTracker/script/shadow-tracker-script.js&quot;</code>这里下载 shadow-tracker 脚本文件。</p> <h2 id="api-说明"><a href="#api-说明" class="header-anchor">#</a> API 说明</h2> <h3 id="init-options"><a href="#init-options" class="header-anchor">#</a> init(options)</h3> <p>初始化 tracker</p> <p>参数说明：
options - 传入一个配置项对象，详见第四部分“配置项说明”</p> <p>使用样例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>tracker<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="getdeviceinfo"><a href="#getdeviceinfo" class="header-anchor">#</a> getDeviceInfo()</h3> <p>获取用户设备信息并将设备信息写入 logList 中，详见第五部分“logList 说明及自定义 Log”</p> <p>使用样例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tracker<span class="token punctuation">.</span><span class="token function">getDeviceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="getperformanceinfo"><a href="#getperformanceinfo" class="header-anchor">#</a> getPerformanceInfo()</h3> <p>获取页面性能数据并将页面性能信息写入 logList 中，详见第五部分“logList 说明及自定义 Log”</p> <p>使用样例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tracker<span class="token punctuation">.</span><span class="token function">getPerformanceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="getloglist"><a href="#getloglist" class="header-anchor">#</a> getLogList()</h3> <p>获取日志数据，详见第五部分“logList 说明及自定义 Log”</p> <p>使用样例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tracker<span class="token punctuation">.</span><span class="token function">getLogList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="gettimetravelcode"><a href="#gettimetravelcode" class="header-anchor">#</a> getTimeTravelCode()</h3> <p>获取时间旅行代码，详见第六部分“时间旅行功能”</p> <p>使用样例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tracker<span class="token punctuation">.</span><span class="token function">getTimeTravelCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="配置项说明"><a href="#配置项说明" class="header-anchor">#</a> 配置项说明</h2> <p>在初始化 tracker 时，可传入配置项来丰富 tracker 的功能。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 这是shadow-tracker的默认配置项，我们以此为例</span>
<span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">sessionId</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// sessionId，默认为当前时间+一个随机数</span>
  <span class="token literal-property property">useClass</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否使用class作为元素的唯一ID</span>
  <span class="token literal-property property">maxResponseTextLength</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 记录XMLHttpRequest返回值的最大长度</span>
  <span class="token literal-property property">timeTracelInitTime</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token comment">// 生成的时间旅行代码中，初始化页面的等待时间</span>
  <span class="token literal-property property">timeTravelClickDelayTime</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 生成的时间旅行代码中，点击元素的延迟时间</span>
  <span class="token literal-property property">timeTracelInputDelayTime</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 生成的时间旅行代码中，输入数据的延迟时间</span>
  <span class="token literal-property property">captureEvent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否收集事件日志</span>
  <span class="token literal-property property">captureJsError</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否收集错误日志</span>
  <span class="token literal-property property">captureXMLHttpRequest</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否收集请求日志</span>
  <span class="token literal-property property">custom</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否在日志对象中加入自定义数据</span>
  <span class="token function-variable function">customizeLog</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">logType<span class="token punctuation">,</span> logContent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 生成自定义log数据的函数，详见第五部分“logList 说明及自定义 Log”</span>
  <span class="token function-variable function">customizeEventLog</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 生成自定义event log的函数，详见第五部分“logList 说明及自定义 Log”</span>
  <span class="token function-variable function">customizeErrorLog</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 生成自定义error log的函数，详见第五部分“logList 说明及自定义 Log”</span>
  <span class="token function-variable function">customizeXMLHttpRequestLog</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 生成自定义XMLHttpRequest log的函数，详见第五部分“logList 说明及自定义 Log”</span>
  <span class="token function-variable function">customizeDeviceLog</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">userAgent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 生成自定义device log的函数，详见第五部分“logList 说明及自定义 Log”</span>
  <span class="token function-variable function">customizePerformanceLog</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">performance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 生成自定义performance log的函数，详见第五部分“logList 说明及自定义 Log”</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="loglist-说明及自定义-log"><a href="#loglist-说明及自定义-log" class="header-anchor">#</a> logList 说明及自定义 Log</h2> <p>logList 是存储全部日志的 js 数组，我们可以使用<code>getLogList()</code>来获取到这个数组，并针对自己的业务需求进一步开发日志上报、日志储存等逻辑。
另外，我们还可以根据自己的业务需求，对日志对象进行拓展。</p> <p>如果我们需要添加自定义数据，首先我们需要把传入 tracker 的配置项对象中的<code>custom</code>属性赋值为 true，并根据自己的需求实现自定义数据函数。</p> <h3 id="log-对象说明"><a href="#log-对象说明" class="header-anchor">#</a> Log 对象说明</h3> <h4 id="基础说明"><a href="#基础说明" class="header-anchor">#</a> 基础说明</h4> <p>Log 对象是基础的日志对象，它包含如下属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;logTime&quot;</span><span class="token operator">:</span> <span class="token number">1584262658187</span><span class="token punctuation">,</span> <span class="token comment">// 日志产生的时间</span>
  <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;www.shadowingszy.top&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 产生日志页面的url</span>
  <span class="token string-property property">&quot;logSession&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// sessionId</span>
  <span class="token string-property property">&quot;logType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Error Log&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 日志的种类，包含：Event Log | Error Log | XMLHttPRequest Log | Device Log | Performance Log 五种</span>
  <span class="token string-property property">&quot;logContent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 日志的具体信息</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="自定义说明"><a href="#自定义说明" class="header-anchor">#</a> 自定义说明</h4> <p>自定义 Log 对象包含如下属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;logTime&quot;</span><span class="token operator">:</span> <span class="token number">1584262658187</span><span class="token punctuation">,</span> <span class="token comment">// 日志产生的时间</span>
  <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;www.shadowingszy.top&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 产生日志页面的url</span>
  <span class="token string-property property">&quot;logType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Error Log&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 日志的种类，包含：Event Log | Error Log | XMLHttPRequest Log | Device Log | Performance Log 五种</span>
  <span class="token string-property property">&quot;logContent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 日志的具体信息</span>
  <span class="token string-property property">&quot;custom&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> <span class="token comment">// 自定义日志字段</span>
    <span class="token string-property property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 执行配置项中的customizeLog()方法后返回的值</span>
    <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 某一类日志在执行配置项中的对应的customizeEventLog()、customizeErrorLog()、customizeXMLHttpRequestLog()、customizeDeviceLog()、customizePerformanceLog()方法后返回的值</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过实现配置项中的<code>customizeLog</code>方法，我们可以自定义日志对象，并将<code>customizeLog</code>函数的返回值作为 Log 对象中<code>custom.log</code>属性的值。</p> <p><code>customizeLog</code>方法参数说明:</p> <table><thead><tr><th>参数名</th> <th>参数类型</th> <th>参数说明</th></tr></thead> <tbody><tr><td>logType</td> <td>string</td> <td>日志的种类，包含：<code>Event Log | Error Log | XMLHttPRequest Log | Device Log | Performance Log</code> 五种</td></tr> <tr><td>logContent</td> <td>object</td> <td>日志具体信息，即 Log 对象中的<code>logContent</code>属性的值</td></tr></tbody></table> <h3 id="event-log-对象说明"><a href="#event-log-对象说明" class="header-anchor">#</a> Event Log 对象说明</h3> <h4 id="基础说明-2"><a href="#基础说明-2" class="header-anchor">#</a> 基础说明</h4> <p>Event Log 对象是记录用户点击、输入事件的日志对象，它会呈现在对应种类的 Log 对象的<code>logContent</code>属性中。
Event Log 包含“点击”和“输入”两种日志类型，分别包含如下属性：</p> <p>点击事件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;domPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 当前事件的dom路径</span>
  <span class="token string-property property">&quot;trackingType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 事件类别</span>
  <span class="token string-property property">&quot;offsetX&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.5&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 当前点击事件的相对x坐标，如当前页面宽度是700，那么点击事件的x为350</span>
  <span class="token string-property property">&quot;offsetY&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.5&quot;</span> <span class="token comment">// 当前点击事件的相对x坐标，如当前页面宽度是700，那么点击事件的y为350</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输入事件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;domPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 当前事件的dom路径</span>
  <span class="token string-property property">&quot;trackingType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 事件类别</span>
  <span class="token string-property property">&quot;inputKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 输入的值</span>
  <span class="token string-property property">&quot;currentValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span> <span class="token comment">// 当前输入框的值</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="自定义说明-2"><a href="#自定义说明-2" class="header-anchor">#</a> 自定义说明</h4> <p>通过实现配置项中的<code>customizeEventLog</code>方法，我们可以自定义日志对象，并将<code>customizeEventLog</code>函数的返回值作为 Log 对象中<code>custom.detail</code>属性的值。</p> <p><code>customizeEventLog</code>方法参数说明:</p> <table><thead><tr><th>参数名</th> <th>参数类型</th> <th>参数说明</th></tr></thead> <tbody><tr><td>event</td> <td>object</td> <td>当前触发事件的 event 对象</td></tr></tbody></table> <h3 id="error-log-对象说明"><a href="#error-log-对象说明" class="header-anchor">#</a> Error Log 对象说明</h3> <h4 id="基础说明-3"><a href="#基础说明-3" class="header-anchor">#</a> 基础说明</h4> <p>Error Log 对象是记录当前页面发生的 js 错误的日志对象，它会呈现在对应种类的 Log 对象的<code>logContent</code>属性中。
Error Log 对象包含如下属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;errorType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;customize&quot;</span><span class="token punctuation">,</span> <span class="token comment">// error的类型，包含：js | customize | window.onerror | window.onunhandledrejection 四种</span>
  <span class="token string-property property">&quot;errorMsg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is error message&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 报错信息</span>
  <span class="token string-property property">&quot;lineNumber&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 出错位置所在行数</span>
  <span class="token string-property property">&quot;columnNumber&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 出错位置所在列数</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注：errorType 详细说明</p> <table><thead><tr><th>种类</th> <th>说明</th></tr></thead> <tbody><tr><td>js</td> <td>javascript 代码报错</td></tr> <tr><td>customize</td> <td>console.error()报错，此种错误不包含错误堆栈信息</td></tr> <tr><td>window.onerror</td> <td>window.onerror 回调报错</td></tr> <tr><td>window.onunhandledrejection</td> <td>window.onunhandledrejection 回调报错</td></tr></tbody></table> <h4 id="自定义说明-3"><a href="#自定义说明-3" class="header-anchor">#</a> 自定义说明</h4> <p>通过实现配置项中的<code>customizeErrorLog</code>方法，我们可以自定义日志对象，并将<code>customizeErrorLog</code>函数的返回值作为 Log 对象中<code>custom.detail</code>属性的值。</p> <p><code>customizeErrorLog</code>方法参数说明:</p> <table><thead><tr><th>参数名</th> <th>参数类型</th> <th>参数说明</th></tr></thead> <tbody><tr><td>error</td> <td>object</td> <td>触发错误的 error 对象</td></tr></tbody></table> <h3 id="xmlhttprequest-log-对象说明"><a href="#xmlhttprequest-log-对象说明" class="header-anchor">#</a> XMLHttPRequest Log 对象说明</h3> <h4 id="基础说明-4"><a href="#基础说明-4" class="header-anchor">#</a> 基础说明</h4> <p>XMLHttPRequest Log 对象是记录 XMLHttpRequest 的日志对象，它会呈现在对应种类的 Log 对象的<code>logContent</code>属性中。
XMLHttPRequest Log 包含“请求开始”和“请求结束”两种日志类型，分别包含如下属性：</p> <p>请求开始：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ajaxLoadStart&quot;</span> <span class="token comment">// 当前事件</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请求结束：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ajaxLoadEnd&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 当前事件</span>
  <span class="token string-property property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// 状态码</span>
  <span class="token string-property property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// 返回内容</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="自定义说明-4"><a href="#自定义说明-4" class="header-anchor">#</a> 自定义说明</h4> <p>通过实现配置项中的<code>customizeXMLHttpRequestLog</code>方法，我们可以自定义日志对象，并将<code>customizeXMLHttpRequestLog</code>函数的返回值作为 Log 对象中<code>custom.detail</code>属性的值。</p> <p><code>customizeXMLHttpRequestLog</code>方法参数说明:</p> <table><thead><tr><th>参数名</th> <th>参数类型</th> <th>参数说明</th></tr></thead> <tbody><tr><td>event</td> <td>object</td> <td>触发<code>ajaxLoadStart</code>或<code>ajaxLoadEnd</code>的事件</td></tr></tbody></table> <h3 id="device-log-对象说明"><a href="#device-log-对象说明" class="header-anchor">#</a> Device Log 对象说明</h3> <h4 id="基础说明-5"><a href="#基础说明-5" class="header-anchor">#</a> 基础说明</h4> <p>Device Log 对象是记录用户设备信息的日志对象，它会呈现在对应种类的 Log 对象的<code>logContent</code>属性中，包含如下属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否为PC端浏览器</span>
  <span class="token string-property property">&quot;mobile&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否为手机端浏览器</span>
  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;computer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 当前终端的类别，包含：computer, ios, android, wechat, windows phone, unknow</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;80.0.3987.132&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 版本号</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chrome&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 当前浏览器的类别，包含：msie, firefox, chrome, sarfari, android, ios, unknown</span>
  <span class="token string-property property">&quot;userAgent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// navigator.userAgent的值</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="自定义说明-5"><a href="#自定义说明-5" class="header-anchor">#</a> 自定义说明</h4> <p>通过实现配置项中的<code>customizeDeviceLog</code>方法，我们可以自定义日志对象，并将<code>customizeDeviceLog</code>函数的返回值作为 Log 对象中<code>custom.detail</code>属性的值。</p> <p><code>customizeDeviceLog</code>方法参数说明:</p> <table><thead><tr><th>参数名</th> <th>参数类型</th> <th>参数说明</th></tr></thead> <tbody><tr><td>device</td> <td>object</td> <td><code>navigator.userAgent</code>对象</td></tr></tbody></table> <h3 id="performance-log-对象说明"><a href="#performance-log-对象说明" class="header-anchor">#</a> Performance Log 对象说明</h3> <h4 id="基础说明-6"><a href="#基础说明-6" class="header-anchor">#</a> 基础说明</h4> <p>Performance Log 对象是记录页面性能数据的日志对象，它会呈现在对应种类的 Log 对象的<code>logContent</code>属性中，包含如下属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;loadType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;reload&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;loadPageTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 页面加载完成的时间</span>
  <span class="token string-property property">&quot;domReadyTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 解析 DOM 树结构的时间</span>
  <span class="token string-property property">&quot;redirectTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 重定向的时间</span>
  <span class="token string-property property">&quot;domainLookupTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// DNS 查询时间</span>
  <span class="token string-property property">&quot;timeToFirstByte&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 读取页面第一个字节的时间，即用户拿到你的资源占用的时间</span>
  <span class="token string-property property">&quot;requestTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 内容加载完成的时间</span>
  <span class="token string-property property">&quot;loadEventTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 执行 onload 回调函数的时间</span>
  <span class="token string-property property">&quot;cacheTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// DNS 缓存时间</span>
  <span class="token string-property property">&quot;unloadTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 卸载页面的时间</span>
  <span class="token string-property property">&quot;connectTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// TCP 建立连接完成握手的时间</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注：Performance Log 对象使用<code>window.performance</code>来记录页面性能数据，因此只支持 IE9 及以上浏览器</p> <h4 id="自定义说明-6"><a href="#自定义说明-6" class="header-anchor">#</a> 自定义说明</h4> <p>通过实现配置项中的<code>customizePerformanceLog</code>方法，我们可以自定义日志对象，并将<code>customizePerformanceLog</code>函数的返回值作为 Log 对象中<code>custom.detail</code>属性的值。</p> <p><code>customizePerformanceLog</code>方法参数说明:</p> <table><thead><tr><th>参数名</th> <th>参数类型</th> <th>参数说明</th></tr></thead> <tbody><tr><td>performance</td> <td>object</td> <td><code>window.performance</code>对象</td></tr></tbody></table> <h2 id="时间旅行功能"><a href="#时间旅行功能" class="header-anchor">#</a> 时间旅行功能</h2> <p>本功能会根据 logList 中的 Event Log 数据来复现用户的全部操作，并根据日志生成 NightWatch e2e 测试代码，我们只需要安装 NightWatch 并执行这部分代码，便可复现出用户的操作。</p> <p>我们可以在 tacker 的配置项中进行参数设置。</p> <table><thead><tr><th>参数名</th> <th>参数说明</th></tr></thead> <tbody><tr><td>timeTracelInitTime</td> <td>生成的时间旅行代码中，初始化页面的等待时间</td></tr> <tr><td>timeTravelClickDelayTime</td> <td>生成的时间旅行代码中，点击元素的延迟时间</td></tr> <tr><td>timeTracelInputDelayTime</td> <td>生成的时间旅行代码中，输入数据的延迟时间</td></tr></tbody></table> <p>生成代码示例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">browser</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  browser
    <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'www.shadowingszy.top'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>assert<span class="token punctuation">.</span><span class="token function">elementPresent</span><span class="token punctuation">(</span><span class="token string">'#xml-test'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'#xml-test'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>assert<span class="token punctuation">.</span><span class="token function">elementPresent</span><span class="token punctuation">(</span><span class="token string">'#get-log'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'#get-log'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>assert<span class="token punctuation">.</span><span class="token function">elementPresent</span><span class="token punctuation">(</span><span class="token string">'#get-log'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'#get-log'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/shadow-tracker/assets/js/app.0379027f.js" defer></script><script src="/shadow-tracker/assets/js/2.05e023a7.js" defer></script><script src="/shadow-tracker/assets/js/8.03e55139.js" defer></script>
  </body>
</html>
